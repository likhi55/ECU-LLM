# Brake–Throttle Override (BTO) — non‑latching accel cut/scale

## SCR ID
SCR000011

## Objective
When the driver presses the **brake pedal** beyond a calibrated threshold while also
pressing the **accelerator**, scale or cut the accelerator contribution to the engine
response. Unlike SCR9 (limp latch), BTO is **non‑latching** and applies **only while** the
brake condition is true.

## Scope
- Builds on SCR000001–SCR000010.
- No new inputs/outputs.
- Runs **before** SCR2–SCR7 calculations each row by modifying the **effective** accelerator
  angle passed into the baseline pipeline.

## Inputs
Unchanged:
```
time,ignition_switch,acc_pedal_position,brake_pedal_position,current_gear,cruise_enable,cruise_target_speed
```

## Outputs
Unchanged:
```
time,engine_state,engine_speed
```

## Calibrations (append to `app/calibration/calibration.txt`)
- `bto_brake_deg = 10`     # min brake degrees to trigger BTO
- `bto_acc_min_deg = 5`    # only act if accelerator ≥ this
- `bto_acc_scale = 0.0`    # scale on accelerator when BTO active (0=cut, 0..1 allowed)

Notes: values outside ranges are clamped; `bto_acc_scale` is clamped to [0..1].

## Algorithm
For each row (after computing `engine_state` and **before** SCR2 calculations):
```
if brake_pedal_position ≥ bto_brake_deg AND acc_pedal_position ≥ bto_acc_min_deg:
    effective_acc = round(acc_pedal_position * bto_acc_scale)
else:
    effective_acc = acc_pedal_position
```
Use `effective_acc` instead of the raw accelerator angle for SCR2–SCR7 (baseline, cruise,
coastdown, idle). SCR8 (slew), SCR9 (limp), and SCR10 (rev limiter) are unchanged.

## Ordering
- SCR9 (limp) **detection** still uses the raw pedals (overlap plausibility).
- BTO only affects the **actuation** side (what accelerator the baseline sees).

## Acceptance Criteria
- With brake ≥ threshold and accelerator ≥ threshold, engine response is reduced according
  to `bto_acc_scale` (0 = full cut).
- Releasing the brake immediately restores normal accelerator authority.
- Output schema/row count unchanged. Golden tests reflect expected reduction.

## Tests (examples)
- **case1**: Brake+Accel overlap with `bto_acc_scale=0.0` → no speed rise from rest.
- **case2**: Brake held for 5 rows then released → speed ramps starting the release row.
- **case3**: Custom calib with `bto_acc_scale=0.2` and `brake_gain_rpm_per_deg=0` shows a
  gentle ramp (≈ +18 rpm/row in gear 3 with base gain).
